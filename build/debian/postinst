#!/bin/sh

#
# create directories
#
dirs="/var/noaaport/nbsp
/var/noaaport/nbsp/db
/var/noaaport/nbsp/dev
/var/noaaport/nbsp/spool
/var/noaaport/nbsp/cspool
/var/noaaport/nbsp/tmp
/var/noaaport/nbsp/inv
/var/noaaport/nbsp/rss
/var/noaaport/nbsp/recover
/var/noaaport/nbsp/stats
/var/noaaport/data/rst
/var/noaaport/data/digatmos
/var/noaaport/data/digatmos/nexrad
/var/noaaport/data/gempak
/var/noaaport/data/metar
/var/noaaport/data/upperair
/var/noaaport/data/grib
/var/noaaport/data/track
/var/noaaport/data/weatherscope
/var/noaaport/data/inv/rst
/var/noaaport/data/inv/digatmos
/var/noaaport/data/inv/gempak
/var/noaaport/archive/data/spool
/var/noaaport/archive/data/digatmos
/var/noaaport/archive/inv
/var/noaaport/www
/var/log/noaaport
/var/run/nbsp
/var/log/nbsp
/var/log/nbsp/www
/usr/local/etc/nbsp/defaults
/usr/local/etc/nbsp/site
/usr/local/etc/nbsp/rc.d
/usr/local/etc/nbsp/rc.d/rst
/usr/local/etc/nbsp/rc.d/da
/usr/local/etc/nbsp/rc.d/gp
/usr/local/etc/nbsp/rc.d/nbsp
/usr/local/etc/nbsp/rc.d/emwin
/usr/local/etc/nbsp/rc.d/nntp
/usr/local/etc/nbsp/rc.d/rstnntp
/usr/local/etc/nbsp/rc.d/ldm
/usr/local/etc/nbsp/rc.d/pan
/usr/local/etc/nbsp/rc.d/grib
/usr/local/etc/nbsp/rc.d/net
/usr/local/libexec/nbsp/site
/usr/local/share/nbsp/defaults
/usr/local/share/nbsp/site
/usr/local/libexec/nbsp/tclhttpd/site"

for d in $dirs
do
  [ -e $d ] || install -d -m 755 $d
done

#
# install optional files from doc directory
#
docdir=/usr/local/share/doc/nbsp
confdir=/usr/local/etc/nbsp
sharedir=/usr/local/share/nbsp
rcdir=/etc/init.d
nexraddir=/var/noaaport/data/digatmos/nexrad
logrotatedir=/etc/logrotate.d

install -m 0755 $docdir/nbspd.sh-sample $rcdir/nbspd
if [ -n "`which chkconfig`" ]
then
	chkconfig --add nbspd
elif [ -n "`which update-rc.d`" ]
then
	update-rc.d nbspd defaults 99
fi

install -m 0644 $docdir/level3.cfg-sample $nexraddir/grlevel3.cfg
ln -f -s $nexraddir/grlevel3.cfg $nexraddir/config.cfg

#
# configure default
#
cd $confdir/dist
for file in README CONFIGURING \
    gempak.env-sample \
    *.conf-sample \
    *.rc-sample \
    *.def-sample
do
	name=${file%%"-sample"}
	cp $file ../$name
done

for file in *-defaults
do
	name=${file%%"-defaults"}
	cp $file ../defaults/$name
done

for file in *-templates.tgz
do
  tar -C ../defaults -xzf $file
done

#
# shared files
#
cd $sharedir/dist
for file in *-share.tgz
do
  tar -C ../defaults -xzf $file
done

#
# www and tclhttpd
#
cp /usr/local/share/doc/nbsp/www.tgz /var/noaaport/www
cd /var/noaaport/www
tar -xzf www.tgz
rm www.tgz
chown -R root:root *
cd htdocs/pub
[ -e "rst" ] || ln -s /var/noaaport/data/rst rst
[ -e "digatmos" ] || ln -s /var/noaaport/data/digatmos digatmos
[ -e "gempak" ] || ln -s /var/noaaport/data/gempak gempak
[ -e "grib" ] || ln -s /var/noaaport/data/grib grib
[ -e "track" ] || ln -s /var/noaaport/data/track track
[ -d "metarplot" ] || mkdir metarplot
[ -d "statplot" ] || mkdir statplot
[ -d "radmap" ] || mkdir radmap
[ -d "weatherscope/conf" ] || mkdir -p weatherscope/conf
[ -d "weatherscope/client" ] || mkdir -p weatherscope/client
[ -e "weatherscope/data" ] || \
    ln -s /var/noaaport/data/weatherscope weatherscope/data
[ -d "npstats" ] || mkdir npstats

cat <<__EOF__

The configuration files are installed in /usr/local/etc/nbsp.

The installation process should have created various directories
under /var/noaaport, and already enabled the rstfilter and dafilter.
In addition the web server is enabled by default, and can be
accesed as
	
	http://localhost:8015
or
	http://<hostname>:8015

The program will run in this default installation without further
configuration.

An init script is also installed to start automatically the program
at boot time, and stop when the system is shutdown.
It can also be started or stoped manually by executing

	/etc/init.d/nbspd start
	/etc/init.d/nbspd stop
--

__EOF__
