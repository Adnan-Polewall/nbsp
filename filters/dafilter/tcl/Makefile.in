#
# Copyright (c) 2005 Jose F. Nieves <nieves@ltp.upr.clu.edu>
#
# See LICENSE
#
# $Id$
#
@include@ @q@../../../Makefile.inc@q@

TCLTARGET =	dafilter.tcl
TCLSOURCES =	dafilter.tcl.in
FILTERNAME =	dafilter
TOOLNAMES =	nbspaloftcsv

TCLTARGET-MGR =	dafilter-manager.tcl
FILTERNAME-MGR = dafilter-manager
TCLSOURCES-MGR = dafilter-manager.tcl.in

TCLSOURCES-INIT = dafilter.init.in
TCLTARGET-INIT = dafilter.init
TCLINCLUDE-INIT = danntp.init
TCLTMPSED = danntp.tmp.sed

M4SOURCES =	defs.m4 dup.m4 file.m4 grib.m4 pipe.m4 rad.m4 sat.m4 extra.m4 \
		dup-warnings.m4 dup-hurricane.m4 dup-upperair.m4 \
		file-lite.m4 pipe-lite.m4 dup-hurricane-lite.m4 \
		rc.tcl
M4MAIN =	dafilter.m4
M4TARGET =	dafilter.rc-defaults
M4MAIN-LITE =	dafilter-lite.m4
M4TARGET-LITE =	dafilter-lite.rc-defaults
SAMPLES =	dafilter.conf-sample dafilter.rc-sample
DOCSAMPLES =	level3.cfg-sample
TARGET =	${TCLTARGET} ${TCLTARGET-INIT} ${TCLTARGET-MGR} \
		${TOOLNAMES} ${M4TARGET} ${M4TARGET-LITE} \
		${SAMPLES} ${DOCSAMPLES}
TCLSH =		@TCLSH@
INSTALL =	@INSTALL@
OSNAME =	@OSNAME@

all: ${TARGET}

${TCLTARGET}: ${TCLSOURCES}
	sed -e /%TCLSH%/s##${TCLSH}# ${TCLSOURCES} > ${TCLTARGET}

${TCLTARGET-MGR}: ${TCLSOURCES-MGR}
	sed -e /%TCLSH%/s##${TCLSH}# ${TCLSOURCES-MGR} > ${TCLTARGET-MGR}

${TCLTARGET-INIT}: ${TCLSOURCES-INIT} ${TCLINCLUDE-INIT}
	@rm -f ${TCLTMPSED}
	@echo "/%TCLSH%/s##${TCLSH}#" >> ${TCLTMPSED}
	@echo "/@DANNTPINIT@/{" >> ${TCLTMPSED}
	@echo "r ${TCLINCLUDE-INIT}" >> ${TCLTMPSED}
	@echo "d" >> ${TCLTMPSED}
	@echo "}" >> ${TCLTMPSED}
	sed -f ${TCLTMPSED} ${TCLSOURCES-INIT} > ${TCLTARGET-INIT}

${M4TARGET}: ${M4MAIN} ${M4SOURCES}
	m4 ${M4MAIN} > ${M4TARGET}

${M4TARGET-LITE}: ${M4MAIN-LITE} ${M4SOURCES}
	m4 ${M4MAIN-LITE} > ${M4TARGET-LITE}

dafilter.conf-sample: dafilter.conf
	cp dafilter.conf dafilter.conf-sample

dafilter.rc-sample: dafilter.rc 
	cp dafilter.rc dafilter.rc-sample

level3.cfg-sample: level3.cfg
	cp level3.cfg level3.cfg-sample

nbspaloftcsv: nbspaloftcsv.tcl
	 sed -e /%TCLSH%/s##${TCLSH}# nbspaloftcsv.tcl > nbspaloftcsv

install: ${TARGET}
	${INSTALL} -m 755 ${TCLTARGET} ${MYLIBEXECDIR}/${FILTERNAME}
	${INSTALL} -m 644 ${TCLTARGET-INIT} ${MYLIBEXECDIR}
	${INSTALL} -m 755 ${TCLTARGET-MGR} ${MYLIBEXECDIR}/${FILTERNAME-MGR}
	${INSTALL} -m 755 ${TOOLNAMES} ${BINDIR}
	${INSTALL} -m 644 ${SAMPLES} ${M4TARGET} ${M4TARGET-LITE} ${MYCONFDIR}
	${INSTALL} -m 644 ${DOCSAMPLES} ${MYDOCDIR}

clean:
	rm -f *~ ${TARGET} ${TCLTMPSED} Makefile
