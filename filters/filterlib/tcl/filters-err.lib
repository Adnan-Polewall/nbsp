#
# $Id$
#
# This file contains common functions used by all filters. The global
# configuration variables are defined in filters.conf.

proc log_msg s {

    global filterserrlib;

    if {$filterserrlib(usesyslog) == 1} {
	syslog_msg $s;
    } else {
	logfile_msg $s;
    }
}

proc syslog_msg s {

    global argv0;

    set name [file tail $argv0];
    exec logger -t $name -- $s;
}

proc logfile_msg s {

    global argv0 filterserrlib;

    set name [file tail $argv0];
    append logfile $filterserrlib(logdir) "/" $name ".log";
    append msg $name ": " [clock format [clock seconds]] ": " $s; 
    set status [catch {
        set f [open $logfile a];
        puts $f $msg;
        close $f;
    } errmsg];

    if {$status != 0} {
        puts $errmsg;
    }
}

proc log_errInfo {} {

    global errorInfo filterserrlib;

    if {$filterserrlib(errorInfo) == 1} {
	log_msg $errorInfo;
    }
}

#
# Some filter tools use this library. These functions are for their use.
#
proc errx {s} {
	
    global argv0;

    set progname [file tail $argv0];
    puts "$progname: Error: $s";
    exit 1;
}
